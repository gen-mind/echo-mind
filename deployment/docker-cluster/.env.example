# ===============================================
# EchoMind Docker Cluster Configuration
# ===============================================
# Copy this file to .env and fill in your values
#
# For local development: cp .env.example .env
# For production: cp .env.host .env (then customize)

# ===============================================
# Versioning
# ===============================================
# Main version for Docker Hub releases
ECHOMIND_VERSION=0.1.0-beta.3

# Per-service versions (for independent versioning if needed)
API_VERSION=${ECHOMIND_VERSION}
MIGRATION_VERSION=${ECHOMIND_VERSION}
EMBEDDER_VERSION=${ECHOMIND_VERSION}
ORCHESTRATOR_VERSION=${ECHOMIND_VERSION}
CONNECTOR_VERSION=${ECHOMIND_VERSION}
INGESTOR_VERSION=${ECHOMIND_VERSION}
GUARDIAN_VERSION=${ECHOMIND_VERSION}
WEBUI_VERSION=${ECHOMIND_VERSION}
# [DEPRECATED] Old React frontend - keep for reference
WEB_VERSION=${ECHOMIND_VERSION}

# ===============================================
# Paths (relative to docker-compose.yml location)
# ===============================================
CONFIG_PATH=../../config
DATA_PATH=../../data

# ===============================================
# Domain Configuration
# ===============================================
# Base domain - all subdomains are derived from this
# Local: localhost | Production: your-domain.com
DOMAIN=localhost

# Subdomains (derived from DOMAIN)
AUTHENTIK_DOMAIN=auth.${DOMAIN}
API_DOMAIN=api.${DOMAIN}
QDRANT_DOMAIN=qdrant.${DOMAIN}
MINIO_DOMAIN=minio.${DOMAIN}
S3_DOMAIN=s3.${DOMAIN}
PORTAINER_DOMAIN=portainer.${DOMAIN}
POSTGRES_DOMAIN=postgres.${DOMAIN}
NATS_DOMAIN=nats.${DOMAIN}
GRAFANA_DOMAIN=grafana.${DOMAIN}
PROMETHEUS_DOMAIN=prometheus.${DOMAIN}

# ===============================================
# URL Configuration (derived from domains)
# ===============================================
# Protocol: http for local, https for production
PROTOCOL=http

# Public URLs
WEB_URL=${PROTOCOL}://${DOMAIN}
API_URL=${PROTOCOL}://${API_DOMAIN}
AUTHENTIK_URL=${PROTOCOL}://${AUTHENTIK_DOMAIN}

# WebSocket URL (ws:// for local, wss:// for production)
WS_URL=ws://${API_DOMAIN}/api/v1/ws/chat

# CORS allowed origins (comma-separated)
CORS_ORIGINS=${PROTOCOL}://${DOMAIN},${PROTOCOL}://${API_DOMAIN},http://localhost:5173,http://localhost:3000

# Timezone
TZ=UTC

# ===============================================
# SSL Configuration (Let's Encrypt) - Production only
# ===============================================
# Uncomment for production deployment
# ACME_EMAIL=your-email@example.com

# ===============================================
# PostgreSQL Configuration
# ===============================================
POSTGRES_USER=echomind
POSTGRES_PASSWORD=CHANGE_ME_SECURE_PASSWORD
POSTGRES_DB=postgres

# Database names (created by init-db.sql)
AUTHENTIK_DB_NAME=authentik
API_DB_NAME=echomind

# ===============================================
# Authentik Configuration
# ===============================================
# Generate secret key with: openssl rand -base64 32
AUTHENTIK_SECRET_KEY=CHANGE_ME_GENERATE_WITH_OPENSSL

# Bootstrap admin credentials (only used on first startup)
# Username will be: akadmin
AUTHENTIK_BOOTSTRAP_PASSWORD=CHANGE_ME_ADMIN_PASSWORD
AUTHENTIK_BOOTSTRAP_EMAIL=admin@echomind.local

# ===============================================
# MinIO Configuration
# ===============================================
MINIO_ROOT_USER=echomindadmin
MINIO_ROOT_PASSWORD=CHANGE_ME_MINIO_PASSWORD

# ===============================================
# EchoMind WebUI Configuration (Open WebUI Fork)
# ===============================================
# Generate secret key with: openssl rand -hex 32
WEBUI_SECRET_KEY=CHANGE_ME_GENERATE_WITH_OPENSSL
WEBUI_URL=${PROTOCOL}://${DOMAIN}

# OIDC settings for WebUI (using Authentik)
# Create an OAuth2 Provider in Authentik:
# 1. Go to Authentik Admin → Applications → Providers → Create OAuth2 Provider
# 2. Name: echomind-webui
# 3. Client type: Confidential
# 4. Redirect URIs: ${WEBUI_URL}/oauth/oidc/callback
# 5. Copy Client ID and Client Secret below
OIDC_AUTHORITY=${AUTHENTIK_URL}/application/o/echomind-webui/
OIDC_CLIENT_ID=PASTE_CLIENT_ID_FROM_AUTHENTIK
OIDC_CLIENT_SECRET=PASTE_CLIENT_SECRET_FROM_AUTHENTIK

# Build hash for frontend versioning
BUILD_HASH=dev

# ===============================================
# [DEPRECATED] Old React Web Frontend OIDC Settings
# ===============================================
# NOTE: These settings are for the deprecated React frontend.
# Keep for quick rollback if needed.
WEB_OIDC_AUTHORITY=${AUTHENTIK_URL}/application/o/echomind-web/
WEB_OIDC_CLIENT_ID=PASTE_CLIENT_ID_FROM_AUTHENTIK
WEB_OIDC_REDIRECT_URI=${WEB_URL}/auth/callback
WEB_OIDC_POST_LOGOUT_REDIRECT_URI=${WEB_URL}
WEB_OIDC_SCOPE=openid profile email offline_access

# ===============================================
# API Authentication (MUST match Web OIDC settings)
# ===============================================
# These values are derived from the Authentik OAuth2 Provider
# The issuer and JWKS URL use the same provider slug as WEB_OIDC_AUTHORITY
API_AUTH_ISSUER=${WEB_OIDC_AUTHORITY}
API_AUTH_AUDIENCE=${WEB_OIDC_CLIENT_ID}
API_AUTH_JWKS_URL=http://authentik-server:9000/application/o/echomind-web/jwks/

# ===============================================
# Observability (Grafana + Prometheus + Loki)
# ===============================================
ENABLE_OBSERVABILITY=false

# Grafana admin password (used for basic auth login)
GRAFANA_ADMIN_PASSWORD=admin

# Grafana Authentik OIDC (optional — see config/observability/README.md)
# Set GRAFANA_OAUTH_ENABLED=true after creating provider in Authentik
GRAFANA_OAUTH_ENABLED=false
GRAFANA_OAUTH_CLIENT_ID=
GRAFANA_OAUTH_CLIENT_SECRET=
