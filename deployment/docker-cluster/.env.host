# ===============================================
# EchoMind Docker Cluster Configuration
# Production deployment
# ===============================================

# ===============================================
# HuggingFace Access Token (for Docker build)
# ===============================================
# CRITICAL: Used at BUILD TIME to pre-download models into Docker images
# Get token at: https://huggingface.co/settings/tokens (Select "Read" role)
# Leave empty to download without auth (may hit rate limits)
HF_TOKEN=

# Enables the observability stack
ENABLE_OBSERVABILITY=true

# ===============================================
# Versioning
# ===============================================
# Main version for Docker Hub releases
ECHOMIND_VERSION=0.1.0-beta.5

# Per-service versions (for independent versioning if needed)
API_VERSION=${ECHOMIND_VERSION}
MIGRATION_VERSION=${ECHOMIND_VERSION}
EMBEDDER_VERSION=${ECHOMIND_VERSION}
ORCHESTRATOR_VERSION=${ECHOMIND_VERSION}
CONNECTOR_VERSION=${ECHOMIND_VERSION}
INGESTOR_VERSION=${ECHOMIND_VERSION}
GUARDIAN_VERSION=${ECHOMIND_VERSION}
WEBUI_VERSION=${ECHOMIND_VERSION}

# ===============================================
# Paths (relative to docker-compose.yml location)
# ===============================================
CONFIG_PATH=../../config
DATA_PATH=../../data

# ===============================================
# Domain Configuration
# ===============================================
# Base domain - all subdomains are derived from this
DOMAIN=demo.echomind.ch

# Subdomains (derived from DOMAIN)
AUTHENTIK_DOMAIN=auth.${DOMAIN}
API_DOMAIN=api.${DOMAIN}
QDRANT_DOMAIN=qdrant.${DOMAIN}
MINIO_DOMAIN=minio.${DOMAIN}
S3_DOMAIN=s3.${DOMAIN}
PORTAINER_DOMAIN=portainer.${DOMAIN}
POSTGRES_DOMAIN=postgres.${DOMAIN}
NATS_DOMAIN=nats.${DOMAIN}
GRAFANA_DOMAIN=grafana.${DOMAIN}
PROMETHEUS_DOMAIN=prometheus.${DOMAIN}

# ===============================================
# URL Configuration (derived from domains)
# ===============================================
# Protocol (https for production, http for local)
PROTOCOL=https

# Public URLs
WEB_URL=${PROTOCOL}://${DOMAIN}
API_URL=${PROTOCOL}://${API_DOMAIN}
AUTHENTIK_URL=${PROTOCOL}://${AUTHENTIK_DOMAIN}

# WebSocket URL (must include full path)
WS_URL=wss://${API_DOMAIN}/api/v1/ws/chat

# CORS allowed origins (comma-separated)
CORS_ORIGINS=${PROTOCOL}://${DOMAIN},${PROTOCOL}://${API_DOMAIN},http://localhost:5173,http://localhost:3000

# Timezone
TZ=Europe/Zurich

# ===============================================
# SSL Configuration (Let's Encrypt)
# ===============================================
ACME_EMAIL=admin@echomind.ch

# ===============================================
# PostgreSQL Configuration
# ===============================================
POSTGRES_USER=echomind
POSTGRES_PASSWORD=CHANGE_ME_POSTGRES_PASSWORD
POSTGRES_DB=postgres

# Database names (created by init-db.sql)
AUTHENTIK_DB_NAME=authentik
API_DB_NAME=echomind

# ===============================================
# Authentik Configuration
# ===============================================
AUTHENTIK_SECRET_KEY=CHANGE_ME_GENERATE_RANDOM_KEY
AUTHENTIK_BOOTSTRAP_PASSWORD=CHANGE_ME_ADMIN_PASSWORD
AUTHENTIK_BOOTSTRAP_EMAIL=admin@echomind.ch

# ===============================================
# MinIO Configuration
# ===============================================
MINIO_ROOT_USER=echomindadmin
MINIO_ROOT_PASSWORD=CHANGE_ME_MINIO_PASSWORD

# ===============================================
# WebUI Build
# ===============================================
BUILD_HASH=prod

# ===============================================
# OIDC Settings (from Authentik OAuth2 Provider)
# ===============================================
# After creating the app in Authentik, set these values:
# 1. Go to Authentik Admin → Applications → Providers → Create OAuth2 Provider
# 2. Name: echomind-web
# 3. Client Type: Confidential
# 4. Client ID: (auto-generated, copy here)
# 5. Client Secret: (auto-generated, copy here)
# 6. Redirect URIs:
#    - ${WEB_URL}/auth/callback (legacy React frontend)
#    - ${WEB_URL}/oauth/oidc/callback (Open WebUI frontend)
WEB_OIDC_AUTHORITY=${AUTHENTIK_URL}/application/o/echomind-web/
WEB_OIDC_CLIENT_ID=PASTE_CLIENT_ID_FROM_AUTHENTIK
WEB_OIDC_CLIENT_SECRET=PASTE_CLIENT_SECRET_FROM_AUTHENTIK
WEB_OIDC_SCOPE=openid profile email

# ===============================================
# API Authentication (MUST match Web OIDC settings)
# ===============================================
# These values are derived from the Authentik OAuth2 Provider
# The issuer and JWKS URL use the same provider slug as WEB_OIDC_AUTHORITY
API_AUTH_ISSUER=${WEB_OIDC_AUTHORITY}
API_AUTH_AUDIENCE=${WEB_OIDC_CLIENT_ID}
API_AUTH_JWKS_URL=http://authentik-server:9000/application/o/echomind-web/jwks/

# ===============================================
# Observability (Grafana + Prometheus + Loki)
# ===============================================
ENABLE_OBSERVABILITY=false

# Grafana admin password (used for basic auth login)
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_GRAFANA_PASSWORD

# Grafana Authentik OIDC (optional — see config/observability/README.md)
# Set GRAFANA_OAUTH_ENABLED=true after creating provider in Authentik
GRAFANA_OAUTH_ENABLED=false
GRAFANA_OAUTH_CLIENT_ID=
GRAFANA_OAUTH_CLIENT_SECRET=
